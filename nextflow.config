import java.time.*
Date now = new Date()

// change according to compute infrastructure- 'lsf', 'slurm', 'local'
process.executor = 'lsf'

params {
    outDir = "output"
    traceDir = "${params.outDir}/pipeline_info"
    tmpDir = "${params.outDir}/tmp/"
    timestamp = now.format("yyyyMMdd-HH-mm-ss")
    seq = "P2"
    maxThreads = 64
    minimumMgmtCov = 5
    ref = "/b06x-isilon/b06x-m/mnp_nanopore/software/hg38/hg38.fa" // Set this to the path to the reference genome
    annovarPath = "/b06x-isilon/b06x-m/mnp_nanopore/software/annovar/annovar/" // Set this to the path to the ANNOVAR installation
    annovarDB = "/b06x-isilon/b06x-m/mnp_nanopore/software/annovar/humandb/" // Set this to the path to the ANNOVAR annotations
    annotsvAnnot = "/opt/AnnotSV/Annotations_Human/" // Set this to the path to the AnnotSV annotations
    bamMinCoverage = 10
    cnvGenes = "data/genes.bed"
    annotations = "data/refGene.txt"
    modkitThreads = 32
    cnvThreads  = 32
    snifflesThreads = 32
    snpThreads = 64
    svThreads = 64
    covThreads = 8
    methThreads = 64
    mgmtThreads = 8
    runHumanVariation = false
    bamMinCoverage = 10
    mnpFlex = false
    containerEngine = 'docker' // Set to 'docker' or 'singularity' (default: docker)
    logDir = 'logDir'
    patient = null // Will be set to id if not specified
}

process {
  withLabel:rapid_cns {
    container = 'areebapatel/rapid_cns:latest'
    clusterOptions = "-n 8 -q verylong -R rusage[mem=32G]"
  }

  withLabel:mods {
    container = 'ontresearch/modkit'
    clusterOptions = "-n 32 -q verylong -R rusage[mem=32G]" 
  }

  withLabel:gpu {
    clusterOptions = "-n 8 -q gpu-lowprio-debian -R rusage[mem=16G] -gpu num=1:j_exclusive=yes:gmem=16G"
  }

  withName:variantCalling {
    container = 'nvcr.io/nvidia/clara/clara-parabricks:4.5.1-1'
  }
}

// Container engine selection
singularity {
    enabled = params.containerEngine == 'singularity'
}
docker {
    enabled = params.containerEngine == 'docker'
}

profiles {
  lsf {
    process.executor = 'lsf'
    process.queue = 'normal'
    process.memory = '8 GB'
    process.cpus = 2
  }

  slurm {
    process.executor = 'slurm'
    process.queue = 'batch'
    process.memory = '8 GB'
    process.cpus = 2
  }

  local {
    process.executor = 'local'
    process.memory = '4 GB'
    process.cpus = 1
  }
}

timeline {
  enabled = true
  file = "${params.outDir}/pipeline_info/${params.timestamp}_timeline.html"
}

report {
  enabled = true
  file = "${params.outDir}/pipeline_info/${params.timestamp}_report.html"
}

trace {
  enabled = true
  file = "${params.outDir}/pipeline_info/${params.timestamp}_trace.txt"
}